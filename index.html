<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Wheel - Loem Agency</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Confetti Library for celebration -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: radial-gradient(circle at center, #2b1055, #7597de);
            overflow-x: hidden;
        }

        /* Wheel Container */
        .wheel-container {
            position: relative;
            width: 90vw;
            max-width: 400px;
            height: 90vw;
            max-height: 400px;
            margin: 0 auto;
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 10px solid #ffffff;
            background-color: #fff;
            transition: transform 0.1s;
        }

        /* The actual canvas wheel */
        #canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: block;
        }

        /* The Pointer (Triangle) */
        .pointer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 50px;
            background: #ff3b3b;
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 20;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
        }

        /* Spin Button */
        .spin-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            border-radius: 50%;
            border: 4px solid #2b1055;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: #2b1055;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s, background 0.2s;
            user-select: none;
        }

        .spin-btn:active {
            transform: translate(-50%, -50%) scale(0.95);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Modal Animation */
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .modal-content {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* Custom Scrollbar for Settings */
        .settings-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .settings-scroll::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-radius: 4px;
        }
        .settings-scroll::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 4px;
        }
        .settings-scroll::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col items-center justify-between p-4">

    <!-- Header & Language Switcher -->
    <header class="w-full flex justify-between items-center max-w-4xl mb-6 relative z-30">
        <div class="font-bold text-xl md:text-2xl tracking-wider text-yellow-300 flex items-center gap-2">
            <span id="brandName">LUCKY WHEEL</span>
        </div>
        
        <div class="flex gap-2">
            <!-- Settings Button -->
            <button onclick="openSettings()" class="bg-white/20 hover:bg-white/30 transition w-10 h-10 flex items-center justify-center rounded-full border border-white/30 backdrop-blur-sm" title="C·∫•u h√¨nh / Settings">
                ‚öôÔ∏è
            </button>
            
            <!-- Language Button -->
            <button id="langToggle" class="bg-white/20 hover:bg-white/30 transition px-4 py-2 rounded-full text-sm font-semibold border border-white/30 backdrop-blur-sm">
                üáªüá≥ VN / üá¨üáß EN
            </button>
        </div>
    </header>

    <!-- Main Game Area -->
    <main class="flex flex-col items-center justify-center w-full flex-grow relative z-10">
        
        <!-- Game Title -->
        <h1 id="gameTitle" class="text-3xl md:text-5xl font-black mb-8 text-center drop-shadow-lg text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-pink-500">
            V√íNG QUAY MAY M·∫ÆN
        </h1>

        <!-- The Wheel -->
        <div class="wheel-container mb-10">
            <div class="pointer"></div>
            <canvas id="canvas" width="500" height="500"></canvas>
            
            <!-- Center Button -->
            <div class="spin-btn" id="spinBtn" onclick="spin()">
                <span id="spinText">QUAY</span>
            </div>
        </div>

        <!-- Recent Winners or Instructions (Optional decoration) -->
        <div class="glass-panel p-4 max-w-md w-full text-center">
            <p id="instructionText" class="text-sm md:text-base opacity-90">
                Nh·∫•n n√∫t ·ªü gi·ªØa ƒë·ªÉ th·ª≠ v·∫≠n may c·ªßa b·∫°n!
            </p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="w-full text-center py-4 mt-6 text-white/50 text-xs md:text-sm">
        <p>&copy; 2024 Design by <span class="font-bold text-white">Loem Agency</span></p>
    </footer>

    <!-- Winner Modal -->
    <div id="resultModal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4">
        <div class="modal-content bg-white text-gray-800 rounded-2xl p-8 max-w-sm w-full text-center relative overflow-hidden shadow-2xl">
            <!-- Decorative background blob -->
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-pink-500 to-yellow-500"></div>
            
            <h2 id="congratsTitle" class="text-2xl font-bold mb-2 text-purple-700">CH√öC M·ª™NG!</h2>
            <p id="congratsSubtitle" class="text-gray-500 mb-6">B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c:</p>
            
            <div id="winnerResult" class="text-3xl font-black text-pink-600 mb-8 break-words transform scale-110 transition-transform">
                <!-- Result goes here -->
            </div>
            
            <button onclick="closeModal()" id="closeBtn" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold py-3 rounded-xl hover:shadow-lg hover:scale-[1.02] transition">
                Ti·∫øp t·ª•c ch∆°i
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4">
        <div class="modal-content bg-white text-gray-800 rounded-2xl p-6 max-w-lg w-full relative overflow-hidden shadow-2xl flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h2 id="settingsTitle" class="text-xl font-bold text-gray-800">C·∫•u h√¨nh v√≤ng quay</h2>
                <button onclick="closeSettings()" class="text-gray-500 hover:text-red-500 text-2xl font-bold">&times;</button>
            </div>
            
            <!-- List Header -->
            <div class="grid grid-cols-12 gap-2 text-xs font-bold text-gray-500 mb-2 px-1">
                <div class="col-span-1 text-center">Color</div>
                <div class="col-span-5">Ti·∫øng Vi·ªát</div>
                <div class="col-span-5">English</div>
                <div class="col-span-1"></div>
            </div>

            <!-- Scrollable List -->
            <div id="prizesList" class="flex-grow overflow-y-auto settings-scroll mb-4 px-1 space-y-2">
                <!-- Javascript will populate this -->
            </div>

            <div class="flex gap-2 mt-auto pt-2 border-t">
                <button onclick="addPrizeRow()" id="btnAdd" class="flex-1 bg-green-100 text-green-700 py-2 rounded-lg font-bold hover:bg-green-200 transition">
                    + Th√™m √¥
                </button>
                <button onclick="saveSettings()" id="btnSave" class="flex-1 bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 transition">
                    L∆∞u & ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        // Initial Defaults
        let prizes = [
            { text_vn: "10.000ƒë", text_en: "$1", color: '#FF6B6B' },
            { text_vn: "Ch√∫c may m·∫Øn", text_en: "Good Luck", color: '#4ECDC4' },
            { text_vn: "Voucher 50%", text_en: "50% Off", color: '#FFE66D' },
            { text_vn: "Th√™m l∆∞·ª£t", text_en: "Extra Spin", color: '#1A535C' },
            { text_vn: "50.000ƒë", text_en: "$5", color: '#FF9F1C' },
            { text_vn: "M·∫•t l∆∞·ª£t", text_en: "Miss Turn", color: '#FF4081' },
            { text_vn: "Voucher 20%", text_en: "20% Off", color: '#2EC4B6' },
            { text_vn: "Qu√† b√≠ m·∫≠t", text_en: "Secret Gift", color: '#6B5B95' }
        ];

        // --- Language State ---
        let currentLang = 'vn'; // 'vn' or 'en'
        const langData = {
            vn: {
                title: "V√íNG QUAY MAY M·∫ÆN",
                spin: "QUAY",
                instruction: "Nh·∫•n n√∫t ·ªü gi·ªØa ƒë·ªÉ th·ª≠ v·∫≠n may c·ªßa b·∫°n!",
                congrats: "CH√öC M·ª™NG!",
                subtitle: "B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c:",
                close: "Ti·∫øp t·ª•c ch∆°i",
                settingsTitle: "C·∫•u h√¨nh v√≤ng quay",
                btnAdd: "+ Th√™m √¥",
                btnSave: "L∆∞u & ƒê√≥ng"
            },
            en: {
                title: "LUCKY WHEEL",
                spin: "SPIN",
                instruction: "Press the center button to try your luck!",
                congrats: "CONGRATULATIONS!",
                subtitle: "You have won:",
                close: "Play Again",
                settingsTitle: "Wheel Settings",
                btnAdd: "+ Add Segment",
                btnSave: "Save & Close"
            }
        };

        // --- Wheel Variables ---
        let startAngle = 0;
        let arc = Math.PI / (prizes.length / 2);
        let spinTimeout = null;
        let spinArcStart = 10;
        let spinTime = 0;
        let spinTimeTotal = 0;
        let ctx;
        let isSpinning = false;

        // --- Initialization ---
        document.addEventListener("DOMContentLoaded", () => {
            initCanvas();
            drawWheel();
            updateLanguageUI();
        });

        document.getElementById('langToggle').addEventListener('click', toggleLanguage);
        
        // Handle resize to keep wheel responsive/sharp
        window.addEventListener('resize', () => {
             drawWheel();
        });

        function initCanvas() {
            const canvas = document.getElementById("canvas");
            // Set canvas resolution high for sharpness
            canvas.width = 500;
            canvas.height = 500;
        }

        function drawWheel() {
            const canvas = document.getElementById("canvas");
            if (!canvas.getContext) return;
            
            arc = Math.PI / (prizes.length / 2); // Update arc based on current prizes length
            
            ctx = canvas.getContext("2d");
            const outsideRadius = 240; 
            const textRadius = 160;
            const insideRadius = 50;

            ctx.clearRect(0, 0, 500, 500);
            ctx.strokeStyle = "white";
            ctx.lineWidth = 2;
            
            // Dynamic font size based on number of slices
            let fontSize = 24;
            if(prizes.length > 12) fontSize = 16;
            else if(prizes.length > 8) fontSize = 20;

            ctx.font = `bold ${fontSize}px Montserrat, sans-serif`;

            for(let i = 0; i < prizes.length; i++) {
                const angle = startAngle + i * arc;
                
                // Draw slice
                ctx.fillStyle = prizes[i].color;
                ctx.beginPath();
                ctx.arc(250, 250, outsideRadius, angle, angle + arc, false);
                ctx.arc(250, 250, insideRadius, angle + arc, angle, true);
                ctx.stroke();
                ctx.fill();

                // Draw Text
                ctx.save();
                ctx.fillStyle = "white";
                ctx.shadowColor = "rgba(0,0,0,0.5)";
                ctx.shadowBlur = 4;
                ctx.translate(250 + Math.cos(angle + arc / 2) * textRadius, 
                            250 + Math.sin(angle + arc / 2) * textRadius);
                ctx.rotate(angle + arc / 2 + Math.PI / 2);
                
                const text = currentLang === 'vn' ? prizes[i].text_vn : prizes[i].text_en;
                // Truncate long text
                let displayText = text;
                if(text.length > 15) displayText = text.substring(0, 12) + '...';

                ctx.fillText(displayText, -ctx.measureText(displayText).width / 2, 0);
                ctx.restore();
            }
        }

        // --- Spin Logic ---
        function spin() {
            if(isSpinning) return;
            
            isSpinning = true;
            // Disable buttons during spin
            document.getElementById('spinBtn').style.pointerEvents = 'none';
            
            spinAngleStart = Math.random() * 10 + 10; 
            spinTime = 0;
            spinTimeTotal = Math.random() * 3 + 4 * 1000; 
            
            rotateWheel();
        }

        function rotateWheel() {
            spinTime += 30;
            if(spinTime >= spinTimeTotal) {
                stopRotateWheel();
                return;
            }
            
            const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
            startAngle += (spinAngle * Math.PI / 180);
            drawWheel();
            spinTimeout = requestAnimationFrame(rotateWheel);
        }

        function stopRotateWheel() {
            isSpinning = false;
            document.getElementById('spinBtn').style.pointerEvents = 'auto';
            
            const degrees = startAngle * 180 / Math.PI + 90;
            const arcd = arc * 180 / Math.PI;
            const index = Math.floor((360 - degrees % 360) / arcd);
            
            ctx.save();
            ctx.font = 'bold 30px Montserrat, sans-serif';
            // Handle edge case where index might be out of bounds due to floating point
            let winnerIndex = index;
            if (winnerIndex >= prizes.length) winnerIndex = 0;
            
            const winnerText = currentLang === 'vn' ? prizes[winnerIndex].text_vn : prizes[winnerIndex].text_en;
            ctx.restore();
            
            fireConfetti();
            showModal(winnerText);
        }

        function easeOut(t, b, c, d) {
            t /= d;
            t--;
            return c * (t*t*t + 1) + b;
        }

        // --- UI & Language Logic ---
        function toggleLanguage() {
            currentLang = currentLang === 'vn' ? 'en' : 'vn';
            updateLanguageUI();
            drawWheel();
        }

        function updateLanguageUI() {
            const data = langData[currentLang];
            document.getElementById('gameTitle').innerText = data.title;
            document.getElementById('spinText').innerText = data.spin;
            document.getElementById('instructionText').innerText = data.instruction;
            document.getElementById('congratsTitle').innerText = data.congrats;
            document.getElementById('congratsSubtitle').innerText = data.subtitle;
            document.getElementById('closeBtn').innerText = data.close;
            
            // Settings UI Language
            document.getElementById('settingsTitle').innerText = data.settingsTitle;
            document.getElementById('btnAdd').innerText = data.btnAdd;
            document.getElementById('btnSave').innerText = data.btnSave;
        }

        // --- Settings Modal Logic ---
        function openSettings() {
            const modal = document.getElementById('settingsModal');
            const list = document.getElementById('prizesList');
            list.innerHTML = ''; // Clear current list

            // Generate Input Rows
            prizes.forEach((prize, index) => {
                const row = document.createElement('div');
                row.className = 'grid grid-cols-12 gap-2 items-center';
                row.innerHTML = `
                    <div class="col-span-1">
                        <input type="color" value="${prize.color}" class="prize-color w-full h-8 rounded cursor-pointer border-0 p-0">
                    </div>
                    <div class="col-span-5">
                        <input type="text" value="${prize.text_vn}" class="prize-vn w-full border border-gray-300 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500" placeholder="VN">
                    </div>
                    <div class="col-span-5">
                        <input type="text" value="${prize.text_en}" class="prize-en w-full border border-gray-300 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500" placeholder="EN">
                    </div>
                    <div class="col-span-1 text-right">
                        <button onclick="deletePrizeRow(this)" class="text-red-400 hover:text-red-600 font-bold p-1">‚úï</button>
                    </div>
                `;
                list.appendChild(row);
            });

            modal.classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function addPrizeRow() {
            const list = document.getElementById('prizesList');
            const row = document.createElement('div');
            row.className = 'grid grid-cols-12 gap-2 items-center';
            // Random color for new item
            const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16);
            
            row.innerHTML = `
                <div class="col-span-1">
                    <input type="color" value="${randomColor}" class="prize-color w-full h-8 rounded cursor-pointer border-0 p-0">
                </div>
                <div class="col-span-5">
                    <input type="text" value="" class="prize-vn w-full border border-gray-300 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500" placeholder="VN">
                </div>
                <div class="col-span-5">
                    <input type="text" value="" class="prize-en w-full border border-gray-300 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500" placeholder="EN">
                </div>
                <div class="col-span-1 text-right">
                    <button onclick="deletePrizeRow(this)" class="text-red-400 hover:text-red-600 font-bold p-1">‚úï</button>
                </div>
            `;
            list.appendChild(row);
            // Scroll to bottom
            list.scrollTop = list.scrollHeight;
        }

        function deletePrizeRow(btn) {
            const list = document.getElementById('prizesList');
            if(list.children.length <= 2) {
                alert("C·∫ßn √≠t nh·∫•t 2 √¥ ƒë·ªÉ quay!");
                return;
            }
            btn.parentElement.parentElement.remove();
        }

        function saveSettings() {
            const list = document.getElementById('prizesList');
            const rows = list.querySelectorAll('.grid');
            const newPrizes = [];

            rows.forEach(row => {
                const color = row.querySelector('.prize-color').value;
                const vn = row.querySelector('.prize-vn').value.trim();
                const en = row.querySelector('.prize-en').value.trim();

                if(vn && en) {
                    newPrizes.push({
                        text_vn: vn,
                        text_en: en,
                        color: color
                    });
                }
            });

            if(newPrizes.length < 2) {
                alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin cho √≠t nh·∫•t 2 √¥!");
                return;
            }

            prizes = newPrizes;
            startAngle = 0; // Reset angle
            drawWheel();
            closeSettings();
        }

        // --- Modal & FX ---
        function showModal(result) {
            const modal = document.getElementById('resultModal');
            document.getElementById('winnerResult').innerText = result;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            const modal = document.getElementById('resultModal');
            modal.classList.add('hidden');
        }

        function fireConfetti() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 60 };

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }
    </script>
</body>
</html>
